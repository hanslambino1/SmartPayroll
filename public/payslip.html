<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Payroll - Payslip</title>
  <link rel="stylesheet" href="payslip.css">
</head>
<body>
  <!-- ===== HEADER ===== -->
  <header class="header">
    <div class="logo-section">
      <img src="SPlogo.png" alt="Smart Payroll Logo">
      <h1><strong>Smart</strong> <span class="blue">Payroll</span></h1>
    </div>

    <nav class="nav">
      <a href="homepage.html">Home</a>
      <span>|</span>
      <a href="payslip.html" class="active">My Payslip</a>
      <span>|</span>
      <button class="logout-btn" onclick="logout()">Logout</button>
    </nav>
  </header>

  <!-- ===== PAYSLIP CARD ===== -->
  <main>
    <div class="payslip-card">

      <!-- Top Buttons -->
      <div class="payslip-actions">
        <a href="payslip_record.html" class="record-btn">Payslip Records</a>
        <button id="downloadBtn">Download Payslip</button>
      </div>

      <div class="payslip-header">
        <h2 id="payslipTitle">Payslip for the month of October 1–15 2025</h2>
        <select id="payslipPeriod">
          <option>October 1–15 2025</option>
          <option>October 16–31 2025</option>
        </select>
      </div>

      <!-- Employee Details -->
      <div class="employee-details">
        <p><strong>Name:</strong> Adriane Tuliao</p>
        <p><strong>Position:</strong> Maintenance Personnel</p>
        <p><strong>Department:</strong> Information Technology (IT)</p>
        <p><strong>Employee ID:</strong> 223-001</p>
      </div>

      <!-- Combined Table -->
      <div class="combined-table">
        <table id="salaryTable">
          <thead>
            <tr>
              <th>Earnings</th>
              <th>Amount</th>
              <th>Deductions</th>
              <th>Amount</th>
            </tr>
          </thead>
          <tbody></tbody>
          <tfoot>
            <tr>
              <td><strong>Total Earnings</strong></td>
              <td id="totalEarnings"><strong>₱ 53,000.00</strong></td>
              <td><strong>Total Deductions</strong></td>
              <td id="totalDeductions"><strong>₱ 5,200.00</strong></td>
            </tr>
          </tfoot>
        </table>
      </div>

      <!-- Net Pay -->
      <div class="netpay">
        <p><strong>Net Pay for the month:</strong> <span>₱ 47,800.00</span></p>
      </div>
    </div>
  </main>

  <!-- ===== LIBRARY: html2pdf ===== -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

  <!-- ===== SCRIPT ===== -->
  <script>
  // ===== LOGOUT FUNCTION =====
  function logout() {
    if (confirm("Are you sure you want to log out?")) {
      window.location.href = "employee_login.html";
    }
  }

  // ===== CHANGE PERIOD DYNAMICALLY =====
  document.getElementById("payslipPeriod").addEventListener("change", function() {
    const title = document.getElementById("payslipTitle");
    const period = this.value;

    title.textContent = "Payslip for the month of " + period;

    const payslipData = {
      "October 1–15 2025": {
        earnings: [
          ["Basic Salary", "₱ 45,000.00"],
          ["Overtime", "₱ 5,000.00"]
        ],
        deductions: [
          ["SSS", "₱ 1,200.00"],
          ["PhilHealth", "₱ 800.00"],
          ["Pag-IBIG", "₱ 200.00"],
          ["Late", "₱ 500.00"],
          ["Undertime", "₱ 1,000.00"],
          ["Tax", "₱ 3,000.00"]
        ],
        netPay: "₱ 47,800.00"
      },
      "October 16–31 2025": {
        earnings: [
          ["Basic Salary", "₱ 45,000.00"],
          ["Overtime", "₱ 3,000.00"]
        ],
        deductions: [
          ["SSS", "₱ 1,200.00"],
          ["PhilHealth", "₱ 800.00"],
          ["Pag-IBIG", "₱ 200.00"],
          ["Late", "₱ 300.00"],
          ["Undertime", "₱ 1,000.00"],
          ["Tax", "₱ 2,800.00"]
        ],
        netPay: "₱ 42,700.00"
      }
    };

    const data = payslipData[period];
    const tbody = document.querySelector("#salaryTable tbody");
    tbody.innerHTML = "";

    const maxRows = Math.max(data.earnings.length, data.deductions.length);
    for (let i = 0; i < maxRows; i++) {
      const earn = data.earnings[i] || ["", ""];
      const ded = data.deductions[i] || ["", ""];
      tbody.innerHTML += `
        <tr>
          <td>${earn[0]}</td><td>${earn[1]}</td>
          <td>${ded[0]}</td><td>${ded[1]}</td>
        </tr>`;
    }

    const totalEarnings = data.earnings.reduce((sum, row) => sum + Number(row[1].replace(/[₱, ]/g, '')), 0);
    const totalDeductions = data.deductions.reduce((sum, row) => sum + Number(row[1].replace(/[₱, ]/g, '')), 0);

    document.getElementById("totalEarnings").innerHTML =
      `<strong>${totalEarnings.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' })}</strong>`;
    document.getElementById("totalDeductions").innerHTML =
      `<strong>${totalDeductions.toLocaleString('en-PH', { style: 'currency', currency: 'PHP' })}</strong>`;

    document.querySelector(".netpay span").textContent = data.netPay;
  });

  // ===== INITIALIZE FIRST PAYSLIP =====
  document.getElementById("payslipPeriod").dispatchEvent(new Event("change"));

  // ===== DOWNLOAD AS PDF =====
  document.getElementById("downloadBtn").addEventListener("click", () => {
    const payslip = document.querySelector(".payslip-card");

    const opt = {
      margin: 0.5,
      filename: document.getElementById("payslipTitle").textContent.replace(/\s+/g, "_") + '.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    };

    html2pdf().set(opt).from(payslip).save();
  });
  </script>
</body>
</html>
