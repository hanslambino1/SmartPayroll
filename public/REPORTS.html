<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SmartPayroll | Reports</title>
  <link rel="stylesheet" href="reports.css">
</head>
<body>
  <div class="container">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sidebar-header">
        <img src="SPlogo.png" alt="Logo" class="logo">
      </div>
      <ul class="menu">
        <li><a href="DASHBOARD.html"><img src="bar-graph.png" class="icon"> Dashboard</a></li>
        <li><a href="EMPLOYEES.html"><img src="group.png" class="icon"> Employees</a></li>
        <li><a href="DTR.html"><img src="timetable.png" class="icon"> Daily Time Record</a></li>
        <li><a href="PAYROLL.html"><img src="user.png" class="icon"> Payroll</a></li>
        <li class="active"><a href="REPORTS.html"><img src="business-report.png" class="icon"> Reports</a></li>
        <li><a href="SETTINGS.html"><img src="gear.png" class="icon"> Settings</a></li>
      </ul>
      <div class="logout-container">
        <button id="logoutBtn" class="logout-btn">
          <img src="logout.png" class="icon"/>Logout
        </button>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main">
      <h1>Reports</h1>

      <div class="controls">
        <select>
          <option>This Month</option>
          <option>Last Month</option>
          <option>This Year</option>
        </select>
      </div>

      <div class="report-box" id="tardiness-box">
        <h2>Tardiness Report</h2>
        <table>
          <thead>
            <tr>
              <th>Employee Name</th>
              <th>Total Late (minutes)</th>
              <th>Days Late</th>
            </tr>
          </thead>
          <tbody id="tardiness-body">
            <tr><td colspan="3">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <div class="report-box" id="undertime-box">
        <h2>Undertime Report</h2>
        <table>
          <thead>
            <tr>
              <th>Employee Name</th>
              <th>Total Undertime (minutes)</th>
            </tr>
          </thead>
          <tbody id="undertime-body">
            <tr><td colspan="2">Loading...</td></tr>
          </tbody>
        </table>
      </div>

      <div class="report-box" id="overtime-box">
        <h2>Overtime Report</h2>
        <table>
          <thead>
            <tr>
              <th>Employee Name</th>
              <th>Total Overtime (minutes)</th>
            </tr>
          </thead>
          <tbody id="overtime-body">
            <tr><td colspan="2">Loading...</td></tr>
          </tbody>
        </table>
      </div>
    </main>
  </div>

  <!-- Logout Confirmation Modal -->
<div id="logoutModal" class="modal-logout">
  <div class="modal-content-logout">
    <div class="modal-header-logout">
      <h3>Confirm Logout</h3>
      <span class="close-btn" id="closeLogout">&times;</span>
    </div>
    <div class="modal-body-logout">
      <p>Are you sure you want to log out of SmartPayroll?</p>
    </div>
    <div class="modal-buttons">
      <button id="confirmLogout" class="confirm-btn">Yes</button>
      <button id="cancelLogout" class="cancel-btn">Cancel</button>
    </div>
  </div>
</div>

<script>
// ===== LOGOUT MODAL =====
  const logoutBtn = document.getElementById("logoutBtn");
  const logoutModal = document.getElementById("logoutModal");
  const confirmLogout = document.getElementById("confirmLogout");
  const cancelLogout = document.getElementById("cancelLogout");

  logoutBtn.addEventListener("click", () => logoutModal.style.display = "flex");
  cancelLogout.addEventListener("click", () => logoutModal.style.display = "none");
  confirmLogout.addEventListener("click", () => {
    fetch("/logout").then(() => window.location.href = "/LOGIN.html");
  });
  window.addEventListener("click", e => {
    if (e.target === logoutModal) logoutModal.style.display = "none";
  });


document.addEventListener("DOMContentLoaded", async () => {
  const main = document.querySelector(".main");
  main.classList.add("show");

  // Fetch reports
  const reports = [
    { type: "tardiness", url: "/api/reports/tardiness" },
    { type: "undertime", url: "/api/reports/undertime/employees" },
    { type: "overtime", url: "/api/reports/overtime/employees" }
  ];

  for (let r of reports) {
    try {
      const res = await fetch(r.url);
      if (!res.ok) throw new Error("Failed to fetch " + r.type);
      const data = await res.json();
      populateTable(r.type, data);
    } catch (err) {
      console.error(err);
      const tbody = document.getElementById(`${r.type}-body`);
      if (tbody) tbody.innerHTML = `<tr><td colspan="3">Error loading data</td></tr>`;
    }
  }
});


function populateTable(type, data) {
  const tbody = document.getElementById(`${type}-body`);
  if (!tbody) return;

  tbody.innerHTML = data.map(row => {
    if (type === "tardiness") {
      return `<tr>
        <td>${row.name}</td>
        <td>${row.totalLate || 0}</td>
        <td>${row.lateDays || 0}</td>
      </tr>`;
    } else if (type === "undertime") {
      return `<tr>
        <td>${row.name}</td>
        <td>${row.totalUndertime || 0}</td>
      </tr>`;
    } else {
      return `<tr>
        <td>${row.name}</td>
        <td>${row.totalOvertime || 0}</td>
      </tr>`;
    }
  }).join("");
}

</script>
</body>
</html>
